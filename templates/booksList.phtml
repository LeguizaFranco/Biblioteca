<?php
require_once './templates/layouts/header.phtml';
?>
<div class="container mt-4">
    <h1 class="text-center mb-4">Lista de Libros</h1>

    <?php if ($this->user): ?>
        <div class="text-end mb-3">
            <a href="addBook" class="btn btn-primary">Agregar Libro</a>
        </div>
    <?php endif; ?>

    <div class="row">
        <?php foreach ($books as $book): ?>
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card shadow-sm h-100">
                    <img src="<?= htmlspecialchars($book->imagen_url, ENT_QUOTES, 'UTF-8'); ?>"
                        class="card-img-top img-fluid mb-3"
                        style="max-width: 80%; height: auto;"
                        alt="Imagen de <?= htmlspecialchars($book->titulo, ENT_QUOTES, 'UTF-8'); ?>">
                    <div class="card-body">
                        <h5 class="card-title"><?= htmlspecialchars($book->titulo, ENT_QUOTES, 'UTF-8'); ?></h5>
                        <a href="bookDetail/<?= $book->id ?>" class="btn btn-outline-primary mt-3">Ver Detalle</a>
                        <?php if ($this->user): ?>
                            <a href="updateBook/<?= $book->id ?>" class="btn btn-warning mt-3">Modificar</a>

                            <button type="button" class="btn btn-danger mt-3" onclick="confirmDelete('<?= htmlspecialchars($book->titulo, ENT_QUOTES, 'UTF-8'); ?>', 'deleteBook/<?= $book->id ?>')">
                                Eliminar
                            </button>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
</div>

<script>
    function confirmDelete(bookTitle, deleteUrl) {
        if (confirm("¿Estás seguro de que deseas eliminar el libro \"" + bookTitle + "\"?")) {
            // Crear un formulario para enviar la solicitud de eliminación
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = deleteUrl;
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = '_method';
            input.value = 'DELETE';
            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>

<?php

?>